<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Miniscript Playground</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  </head>
  <body>
    
    
    <!-- Contenedor envoltorio -->
    <div class="main-wrapper">
      
      <!-- Contenido superior -->
      <header class="top-panel" role="banner">
        <div class="top-panel-inner">
          <a href="https://github.com/AngelTFG/BitcoinMiniscript" target="_blank" rel="noopener" aria-label="Repositorio de GitHub de Bitcoin Miniscript" title="Repositorio de GitHub de Bitcoin Miniscript">
            <img src="btcLogo.png" alt="Logo de Bitcoin Miniscript" title="Logo de Bitcoin Miniscript" class="top-panel-logo">
          </a>
          <h1 class="top-panel-title">Miniscript Playground</h1>
          <a href="https://bitcoin-miniscript.vercel.app/" target="_blank" rel="noopener" class="top-panel-right" aria-label="Abrir Miniscript Playground en nueva pestaÃ±a" title="Abrir Miniscript Playground en nueva pestaÃ±a">ğŸ›</a>
        </div>
      </header>

      <div class="container">

        <!-- Columna izquierda: MenÃº de pÃ³lizas -->
        <nav class="menu" role="navigation" aria-label="MenÃº de pÃ³lizas">
          <h2>ğŸ—‚ï¸ PÃ³lizas disponibles</h2>

          
          <div class="button-row">
            <button class="app-button" title="Herencia digital" aria-label="Herencia digital" onclick="activarPoliza(this, 'htmls/herencia.html')">ğŸ§¬ Herencia digital </button>
          </div>
          <div class="button-row">
            <button class="app-button" title="Autocustodia programada" aria-label="Autocustodia programada" onclick="activarPoliza(this, 'htmls/autocustodia.html')">ğŸ¤– Autocustodia programada </button>
          </div>
          <div class="button-row">
            <button class="app-button" title="BÃ³veda de seguridad" aria-label="BÃ³veda de seguridad" onclick="activarPoliza(this, 'htmls/boveda.html')">ğŸ¦ BÃ³veda de seguridad</button>
          </div>
          <div id="output" class="output-console"></div>
        </nav>
      
          <!-- Columna derecha: Contenido del proyecto -->
          <main class="content" role="main" aria-label="Contenido de la pÃ³liza">
            <h2></h2>
            <div id="content"></div>
          </div>

      </div>
    </div>

    <script>



      /**
       * FunciÃ³n de ayuda para eliminar la indentaciÃ³n comÃºn de un texto multilÃ­nea.
       * Permite escribir plantillas de texto indentadas en el cÃ³digo sin que afecte al HTML.
       */
      function dedent(text) {
        const lines = text.split('\n');
        let firstLineIndex = -1;

        // Encontrar la primera lÃ­nea con contenido
        for (let i = 0; i < lines.length; i++) {
          if (lines[i].trim() !== '') {
            firstLineIndex = i;
            break;
          }
        }

        // Si no hay contenido, devolver cadena vacÃ­a
        if (firstLineIndex === -1) return '';

        // Calcular la indentaciÃ³n de la primera lÃ­nea con contenido
        const indentMatch = lines[firstLineIndex].match(/^\s*/);
        const indent = indentMatch ? indentMatch[0] : '';

        // Eliminar la indentaciÃ³n de todas las lÃ­neas y reconstruir el texto
        return lines.map(line => line.startsWith(indent) ? line.substring(indent.length) : line).join('\n').trim();
      }



      // FunciÃ³n para activar el botÃ³n del menÃº y cargar la pÃ³liza correspondiente
      function activarPoliza(button, url) {
        // Quitar la clase 'active' de todos los botones del menÃº
        document.querySelectorAll('.menu .app-button').forEach(btn => btn.classList.remove('active'));
        // AÃ±adir la clase 'active' al botÃ³n pulsado
        button.classList.add('active');
        // Forzar la recarga de la pÃ³liza aunque sea la misma
        loadProjectByURL(url);
      }

      // Variable para almacenar el proyecto actual cargado y evitar recargas innecesarias
      let proyectoActual = null;

      // FunciÃ³n para cargar el contenido de la pÃ³liza seleccionada
      function loadProjectByURL(proyectoUrl) {
        const scriptName = proyectoUrl.split('/').pop().split('.')[0];
        // Si ya estÃ¡ cargada la misma pÃ³liza, no recargar
        if (proyectoActual === scriptName) return;
        proyectoActual = scriptName;

        // Cargar el contenido HTML de la pÃ³liza seleccionada
        fetch(proyectoUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error('Error al cargar el contenido: ' + response.statusText);
            }
            return response.text();
          })
          .then(html => {
            // Insertar el contenido en el div de la derecha
            document.getElementById('content').innerHTML = html;

            // Eliminar el script de la pÃ³liza cargada anteriormente para evitar conflictos.
            const oldScript = document.querySelector('script[data-policy-script]');
            if (oldScript) {
              oldScript.remove();
            }

            // Crear y aÃ±adir el nuevo script para la pÃ³liza actual.
            const script = document.createElement('script');
            // Se aÃ±ade un timestamp para forzar al navegador a re-ejecutar el script siempre.
            script.src = `./dist/${scriptName}.bundle.js?v=${new Date().getTime()}`;
            // Se aÃ±ade un atributo para poder encontrarlo y borrarlo la prÃ³xima vez.
            script.setAttribute('data-policy-script', 'true');
            document.body.appendChild(script);

            // Mostrar el Ã¡rbol de emojis segÃºn la pÃ³liza seleccionada
            if (scriptName === 'autocustodia') {
              document.getElementById('output').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de Autocustodia Programada. 
                  Uso diario con 2 de 3 llaves. RecuperaciÃ³n a 3 meses con 1 de 2 llaves de respaldo. 
                  Emergencia a 5 meses con la llave de apertura por pÃ©rdida.
                </div><pre aria-hidden="true"><span><span style="font-size:1.5em;">ğŸ¤–</span><span style="font-size:1.2em;"><b> Autocustodia programada </b></span></span>
                â”‚    
                â”‚
                â”œâ”€ ğŸ—“ï¸ <b>Uso diario: ğŸ”‘ğŸ”‘ â¡ï¸ ğŸ”ğŸ”ğŸ” </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ ğŸ”‘ Llave principal 
                â”‚  â”‚ 
                â”‚  â”œâ”€ ğŸ”‘ Llave secundaria
                â”‚  â”‚ 
                â”‚  â””â”€ ğŸ—ï¸ Llave del custodio
                â”‚    
                â”‚    
                â”œâ”€ ğŸ›¡ï¸<b> RecuperaciÃ³n ğŸ•’ 3 meses: ğŸ”‘ â¡ï¸ ğŸ”ğŸ” </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ ğŸ”‘ Llave de respaldo principal
                â”‚  â”‚ 
                â”‚  â””â”€ ğŸ”‘ Llave de respaldo secundaria
                â”‚    
                â”‚    
                â””â”€ ğŸš¨<b> Emergencia â° 5 meses: ğŸ—ï¸ â¡ï¸ ğŸ” </b>
                  â”‚ 
                  â””â”€ ğŸ—ï¸ Llave de apertura por perdida
                </pre>`);
            } else if (scriptName === 'boveda') {
              document.getElementById('output').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de BÃ³veda de Seguridad. 
                  Apertura forzada en 72 horas con la llave de apertura retardada. 
                  BotÃ³n del pÃ¡nico con la llave de apertura inmediata.
                </div><pre aria-hidden="true"><span><span style="font-size:1.5em;">ğŸ¦</span><span style="font-size:1.2em;"><b> BÃ³veda de seguridad </b></span></span>
                â”‚
                â”‚
                â”œâ”€ ğŸ”§ <b>Apertura forzada ğŸ•’ 72 horas: ğŸ”‘ â¡ï¸ ğŸ” </b>
                â”‚  â”‚ 
                â”‚  â””â”€ ğŸ”‘ Llave de apetura retardada
                â”‚
                â”‚
                â””â”€ ğŸ†˜ <b>BotÃ³n del pÃ¡nico: ğŸ—ï¸ â¡ï¸ ğŸ” </b>
                  â”‚
                  â””â”€ ğŸ—ï¸ Llave de apertura inmediata
                </pre>`);
            } else if (scriptName === 'herencia') {
              document.getElementById('output').innerHTML = dedent(`
                <div class="visually-hidden">Resumen de la pÃ³liza de Herencia Digital. 
                  Acceso directo con la llave del progenitor. Herencia a 3 aÃ±os con las llaves de los herederos. 
                  Disputa a 5 aÃ±os con la llave del abogado.
                </div><pre aria-hidden="true"><span><span style="font-size:1.5em;">ğŸ§¬</span><span style="font-size:1.2em;"><b> Herencia digital </b></span></span>
                â”‚
                â”‚
                â”œâ”€ ğŸ§“ğŸ» <b>Acceso directo: ğŸ”‘ â¡ï¸ ğŸ” </b>
                â”‚  â”‚ 
                â”‚  â””â”€ ğŸ”‘ Llave del progenitor
                â”‚
                â”‚
                â”œâ”€ ğŸ§‘ğŸ»ğŸ‘¨ğŸ» <b>Herencia ğŸ•’ 3 aÃ±os: ğŸ”‘ğŸ”‘ â¡ï¸ ğŸ”ğŸ” </b>
                â”‚  â”‚ 
                â”‚  â”œâ”€ ğŸ”‘ Llave de la heredera
                â”‚  â”‚ 
                â”‚  â””â”€ ğŸ”‘ Llave del heredero
                â”‚
                â”‚
                â””â”€ ğŸ‘¤ <b>Disputa â° 5 aÃ±os: ğŸ—ï¸ â¡ï¸ ğŸ” </b>
                  â”‚ 
                  â””â”€ ğŸ—ï¸ Llave del abogado
                </pre>`);
            } else {
              document.getElementById('output').innerHTML = '';
            }
          })
          .catch(error => {
            console.error('Error:', error);
            document.getElementById('content').innerHTML = `<p>Error al cargar el proyecto: ${error.message}</p>`;
          });
      }

      // Autocargar la primera pÃ³liza al iniciar la pÃ¡gina
      document.addEventListener('DOMContentLoaded', () => {
        const firstButton = document.querySelector('.menu .app-button');
        if (firstButton) {
          activarPoliza(firstButton, 'htmls/herencia.html');
        }
      });
    </script>


  </body>
</html>